<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Registered Guests</title>
  <script>
    async function handleSearch(event) {
      event.preventDefault();

      const formData = new FormData(document.getElementById("searchForm"));

      const response = await fetch("/search", {
        method: "POST",
        body: formData
      });

      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "";

      if (response.ok) {
        const data = await response.json();

        if (data.length === 0) {
          resultsDiv.innerHTML = "<p>No matches found.</p>";
          return;
        }

        data.forEach((entry) => {
          const card = document.createElement("div");
          card.className = "result-card";
          card.innerHTML = `
            <p><strong>Customer Code:</strong> ${entry["Customer Code"]}</p>
            <p><strong>Customer Name:</strong> ${entry["Customer Name"]}</p>
            <p><strong>Attendee Name:</strong> ${entry["Attendee Name"]}</p>
            <p><strong>Registration ID:</strong> ${entry["Registration ID"]}</p>
            <button onclick='submitGuest(${JSON.stringify(entry)})'>Submit</button>
          `;
          resultsDiv.appendChild(card);
        });
      } else {
        resultsDiv.innerHTML = "<p>Error occurred during search.</p>";
      }
    }

    async function submitGuest(entry) {
      await fetch("/mark_attendance", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(entry)
      });

      // Send to booth queue
      await fetch("/booth_queue", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ name: entry["Attendee Name"] })
      });

      alert(`Marked attendance and sent to booth: ${entry["Attendee Name"]}`);
    }
  </script>
  <style>
    .result-card {
      border: 1px solid #ccc;
      margin: 10px;
      padding: 10px;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <h1>Registered Guest Lookup</h1>
  <form id="searchForm" onsubmit="handleSearch(event)">
    <label>Customer Code: <input type="text" name="account" /></label><br/>
    <label>Customer Name: <input type="text" name="company" /></label><br/>
    <label>Attendee First Name: <input type="text" name="first" /></label><br/>
    <label>Attendee Last Name: <input type="text" name="last" /></label><br/>
    <label>Registration ID: <input type="text" name="regname" /></label><br/>
    <button type="submit">Search</button>
  </form>

  <div id="results"></div>
</body>
</html>
